<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">

<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/iron-data-table/iron-data-table.html">
<link rel="import" href="../../bower_components/iron-data-table/data-table-column.html">
<link rel="import" href="../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">

<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-item/paper-item-body.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">

<link rel="import" href="ark-m-icons.html">
<link rel="import" href="ark-f-icons.html">

<dom-module id="ark-reader-app">
  <template>
    <style>
      :host {
        display: block;
        height: 100%;
      }

      app-header {
        background-color: #13473f;
        color: #70C0B6;
      }

      * {
        --primary-color: #13473f;
        --primary-text-color: #70C0B6;
      }

      iron-data-table {
        height: calc(100vh - 64px);
      }
    </style>
    <iron-ajax auto url="/data/classes.json" handle-as="json" last-response="{{classes}}"></iron-ajax>
    <iron-ajax auto url="[[_clsUrl(cls)]]" handle-as="json" last-response="{{dinos}}"></iron-ajax>
    <app-drawer-layout>
      <app-drawer swipe-open>
        <div style="height: 100%; overflow: auto;">
          <paper-listbox attr-for-selected="cls" selected="{{cls}}">
            <template is="dom-repeat" items="[[_sortClasses(classes)]]">
              <paper-item cls="[[item.cls]]">[[item.name]]</paper-item>
            </template>
          </paper-listbox>
        </div>
      </app-drawer>
      <app-header-layout>
        <app-header fixed>
          <app-toolbar>
            <paper-icon-button icon="menu" drawer-toggle></paper-icon-button>
            <div title>Q's Ark Reader</div>
          </app-toolbar>
        </app-header>
        <iron-data-table items="[[_filter(dinos)]]" sort-order='[{"direction":"desc","path":"baseLevel"}]'>
          <data-table-column name="Level" sort-by="baseLevel">
            <template>[[item.baseLevel]]</template>
          </data-table-column>
          <data-table-column flex="0.5">
            <template><iron-icon icon="[[_genderIcon(item)]]"></iron-icon></template>
          </data-table-column>
          <data-table-column name="Name" sort-by="name">
            <template>[[item.name]]</template>
          </data-table-column>
          <data-table-column name="Lat">
            <template>[[item.lat]]</template>
          </data-table-column>
          <data-table-column name="Lon">
            <template>[[item.lon]]</template>
          </data-table-column>
          <data-table-column name="Leben" sort-by="wildLevels.health">
            <template>[[_null(item.wildLevels.health)]]</template>
          </data-table-column>
          <data-table-column name="Ausdauer" sort-by="wildLevels.stamina">
            <template>[[_null(item.wildLevels.stamina)]]</template>
          </data-table-column>
          <data-table-column name="Sauerstoff" sort-by="wildLevels.oxygen">
            <template>[[_null(item.wildLevels.oxygen)]]</template>
          </data-table-column>
          <data-table-column name="Nahrung" sort-by="wildLevels.food">
            <template>[[_null(item.wildLevels.food)]]</template>
          </data-table-column>
          <data-table-column name="Gewicht" sort-by="wildLevels.weight">
            <template>[[_null(item.wildLevels.weight)]]</template>
          </data-table-column>
          <data-table-column name="Nahkampf" sort-by="wildLevels.melee">
            <template>[[_null(item.wildLevels.melee)]]</template>
          </data-table-column>
        </iron-data-table>
      </app-header-layout>
    </app-drawer-layout>
  </template>

  <script>
    Polymer({

      is: 'ark-reader-app',

      properties: {
        prop1: {
          type: String,
          value: 'ark-reader-app',
        },
      },

      _clsUrl: function(cls) {
        return '/data/' + cls + '_Character_BP_C.json'
      },

      _sortClasses: function(data) {
        var myData = data.slice()

        myData.sort(function(a,b){
          return a.name > b.name ? 1 : a.name == b.name ? 0 : -1
        })

        return myData
      },

      _filter: function(data) {
        return data.slice(1)
      },

      _null: function(x) {
        return x ? x : 0
      },

      _tamed: function(x) {
        return x.tamed ? 'Name ' + x.name : ''
      },

      _genderIcon: function(x) {
        return x.female ? 'ark-f:female' : 'ark-m:male'
      },

    })
  </script>
</dom-module>
